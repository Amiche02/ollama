---
schemaVersion: 2.0.0

fileExistenceTests:
  - name: Ensure backend main.py exists
    path: /app/main.py
    shouldExist: true

  - name: Ensure Dockerfile.backend does not remain in final image
    path: /app/Dockerfile.backend
    shouldExist: false

  - name: Ensure venv is present
    path: /app/.venv
    shouldExist: true

commandTests:
  - name: Python version
    command: python
    args: ["--version"]
    expectedOutput: ["Python 3.11.*"]
  - name: Python path
    command: which
    args: ["python"]
    expectedOutput: ["/home/appuser/.local/bin:.*"]
  - name: Check user
    command: whoami
    expectedOutput: ["appuser"]

metadataTest:
  workdir: "/app"

  # The backend container typically exposes port 8000
  exposedPorts: ["8000"]

  # Check environment variables if needed
  envVars:
    - key: PATH
      value: "/home/appuser/.local/bin:.*"
      isRegex: true

    # OLLAMA_URL is set in docker-compose to http://ollama:11434
    - key: OLLAMA_URL
      value: ".*11434.*"
      isRegex: true
